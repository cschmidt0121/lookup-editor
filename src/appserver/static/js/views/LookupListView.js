require.config({paths:{datatables:"../app/lookup_editor/js/lib/DataTables/js/jquery.dataTables",bootstrapDataTables:"../app/lookup_editor/js/lib/DataTables/js/dataTables.bootstrap",text:"../app/lookup_editor/js/lib/text",console:"../app/lookup_editor/js/lib/console"},shim:{bootstrapDataTables:{deps:["datatables"]}}});define(["underscore","backbone","models/SplunkDBase","collections/SplunkDsBase","splunkjs/mvc","jquery","splunkjs/mvc/simplesplunkview","text!../app/lookup_editor/js/templates/LookupList.html","bootstrapDataTables","bootstrap.dropdown","css!../app/lookup_editor/css/LookupList.css"],function(m,l,h,a,f,i,k,j,d){var g=a.extend({url:"apps/local?count=-1",initialize:function(){a.prototype.initialize.apply(this,arguments)}});var b=a.extend({url:"/servicesNS/"+Splunk.util.getConfigValue("USERNAME")+"/-/data/lookup-table-files?count=-1",initialize:function(){a.prototype.initialize.apply(this,arguments)}});var c=a.extend({url:"/servicesNS/nobody/-/storage/collections/config?count=-1",initialize:function(){a.prototype.initialize.apply(this,arguments)}});var e=k.extend({className:"LookupListView",defaults:{change_dropdown_titles:true},initialize:function(){this.options=m.extend({},this.defaults,this.options);this.change_dropdown_titles=this.options.change_dropdown_titles;this.filter_app=null;this.filter_type=null;this.filter_scope=null;this.apps=null;this.data_table=null;this.csv_lookups=new b();this.csv_lookups.on("reset",this.gotCSVLookups.bind(this),this);this.csv_lookups.fetch({success:function(){console.info("Successfully retrieved the CSV lookup files")},error:function(){console.error("Unable to fetch the CSV lookup files")}});this.kv_lookups_supported=true;this.kv_lookups=new c();this.kv_lookups.on("reset",this.gotKVLookups.bind(this),this);this.kv_lookups.fetch({success:function(){console.info("Successfully retrieved the KV store lookup files")},error:function(){console.error("Unable to fetch the KV store lookup files")},complete:function(n,o){if(n.status==404){this.hideKVStoreOptions();this.kv_lookups_supported=false}}.bind(this)});this.apps=new g();this.apps.on("reset",this.gotApps.bind(this),this);this.apps.fetch({success:function(){console.info("Successfully retrieved the list of applications")},error:function(){console.error("Unable to fetch the apps")}})},events:{"click .type-filter > .dropdown-menu > li > a":"setTypeFilter","click .app-filter > .dropdown-menu > li > a":"setAppFilter","click .scope-filter > .btn":"setScopeFilter","change #free-text-filter":"applyFilter","keyup #free-text-filter":"goFilter","keypress #free-text-filter":"goFilter"},hideKVStoreOptions:function(){i(".show-kv-supported-only",this.$el).hide();i(".show-kv-unsupported-only",this.$el).show()},setFilterText:function(p,o,n){if(typeof n==="undefined"){n="All"}if(this.change_dropdown_titles){if(n){i("."+p+" > .dropdown-toggle").html(o+": "+n+'<span class="caret"></span>')}else{i("."+p+" > .dropdown-toggle").html(o+'<span class="caret"></span>')}}},setTypeFilter:function(o){var n=i(o.target).text();if(n==="All"){this.filter_type=null}else{this.filter_type=n}this.setFilterText("type-filter","Type",n);i(".type-filter > .dropdown-menu > li > a > i").addClass("hide");i("i",o.currentTarget).removeClass("hide");this.applyFilter()},setScopeFilter:function(o){var n=i(o.target).text();if(n==="All"){this.filter_scope=null}else{if(n.indexOf("Global")>=0){this.filter_scope="nobody"}else{this.filter_scope=Splunk.util.getConfigValue("USERNAME")}}i(".scope-filter > .btn.active").removeClass("active");i(o.currentTarget).addClass("active");this.applyFilter()},setAppFilter:function(o){var n=i(o.target).text();if(n==="All"){this.filter_app=null}else{this.filter_app=n}this.setFilterText("app-filter","App",n);i(".app-filter > .dropdown-menu > li > a > i").addClass("hide");i("i",o.currentTarget).removeClass("hide");this.applyFilter()},goFilter:function(o){var n=o.keyCode||o.which;if(n==13){o.preventDefault()}this.applyFilter()},applyFilter:function(){if(this.filter_type!==null){this.data_table.columns(1).search("^"+this.filter_type+"$",true)}else{this.data_table.columns(1).search("")}if(this.filter_app!==null){this.data_table.columns(2).search("^"+this.filter_app+"$",true)}else{this.data_table.columns(2).search("")}if(this.filter_scope!==null){this.data_table.columns(3).search("^"+this.filter_scope+"$",true)}else{this.data_table.columns(3).search("")}this.data_table.columns(0).search(i("#free-text-filter").val()).draw()},getAppDescriptionFromName:function(n){for(var o=0;o<this.apps.models.length;o++){if(this.apps.models[o].entry.attributes.name===n){return this.apps.models[o].entry.associated.content.attributes.label}}return n},gotCSVLookups:function(){this.renderLookupsList()},gotKVLookups:function(){this.renderLookupsList()},gotApps:function(){this.renderLookupsList()},endsWith:function(o,n){return o.indexOf(n,o.length-n.length)!==-1},isSupportedLookup:function(n){if(this.endsWith(n.name,".default")){return false}else{if(n.name===".DS_Store"){return false}else{return true}}},getLookupsJSON:function(){var o=[];var n=null;for(var p=0;p<this.csv_lookups.models.length;p++){n={name:this.csv_lookups.models[p].entry.attributes.name,author:this.csv_lookups.models[p].entry.attributes.author,updated:this.csv_lookups.models[p].entry.attributes.updated,namespace:this.csv_lookups.models[p].entry.acl.attributes.app,owner:this.csv_lookups.models[p].entry.acl.attributes.owner,type:"csv"};if(!this.endsWith(this.csv_lookups.models[p].entry.attributes.name,".kmz")){o.push(n)}}for(var p=0;p<this.kv_lookups.models.length;p++){n={name:this.kv_lookups.models[p].entry.attributes.name,author:this.kv_lookups.models[p].entry.attributes.author,updated:this.kv_lookups.models[p].entry.attributes.updated,namespace:this.kv_lookups.models[p].entry.acl.attributes.app,owner:this.kv_lookups.models[p].entry.acl.attributes.owner,type:"kv"};o.push(n)}return o.filter(this.isSupportedLookup.bind(this))},getAppsJSON:function(r){if(typeof r==="undefined"){r=true}if(!this.apps){return[]}var q=[];var n=null;for(var p=0;p<this.apps.models.length;p++){n={name:this.apps.models[p].entry.attributes.name,label:this.apps.models[p].entry.associated.content.attributes.label};if(r){for(var o=0;o<this.csv_lookups.models.length;o++){if(this.csv_lookups.models[o].entry.acl.attributes.app===this.apps.models[p].entry.attributes.name){q.push(n);break}}for(var o=0;o<this.kv_lookups.models.length;o++){if(this.kv_lookups.models[o].entry.acl.attributes.app===this.apps.models[p].entry.attributes.name){q.push(n);break}}}else{q.push(n)}}return q},renderLookupsList:function(){var n=i("#lookup-list-template",this.$el).text();i("#content",this.$el).html(m.template(n,{lookups:this.getLookupsJSON(),apps:this.getAppsJSON(),kv_lookups_supported:this.kv_lookups_supported,getAppDescriptionFromName:this.getAppDescriptionFromName.bind(this)}));this.data_table=i("#table",this.$el).DataTable({iDisplayLength:25,bLengthChange:false,searching:true,aLengthMenu:[[25,50,100,-1],[25,50,100,"All"]],bStateSave:false,aaSorting:[[1,"asc"]],aoColumns:[null,null,null,null,{bSortable:false}]});this.setFilterText("type-filter","Type");this.setFilterText("app-filter","App")},render:function(){this.$el.html(j)}});return e});